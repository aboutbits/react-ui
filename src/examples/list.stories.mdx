import IconAdd from '@aboutbits/react-material-icons/dist/IconAdd'
import IconFilterList from '@aboutbits/react-material-icons/dist/IconFilterList'
import { useMatchMediaQuery } from '@aboutbits/react-toolbox'
import { Dialog } from '@reach/dialog'
import { Meta, Story, Canvas, ArgsTable } from '@storybook/addon-docs'
import { action } from '@storybook/addon-actions'
import { useState } from 'react'
import { Actions } from '../components/action'
import {
  Button,
  Variant as ButtonVariant,
  SubmitButton,
} from '../components/button'
import { DialogHeader } from '../components/dialog'
import {
  Section,
  SectionAction,
  SectionTitle,
  SectionContainer,
  SectionContentTitle,
  SectionContentList,
  SectionContentListEmpty,
  SectionHeader,
  SectionHeaderRow,
  SectionHeaderRowLayout,
  SectionHeaderGroup,
  SectionHeaderGroupSpacing,
  SectionFilter,
  SectionSearch,
  SectionListItemButton,
  SectionFooter,
} from '../components/section'
import { SectionFooterWithPaginationInMemory } from '../components/pagination'
import { Select, Variant as InputVariant } from '../components/form'

<Meta title="Examples/List" />

# List

The following example shows how multiple section components and the in memory pagination are used to create an overview list.

Changing the properties `numberOfTotalItems` and `numberOfItemsPerPage` will change the number of pages and/or the number the of items per page.

Setting `numberOfTotalItems` to 0 will reveal the placeholder for the empty list.

export const TemplateDefault = ({
  numberOfTotalItems,
  numberOfItemsPerPage,
}) => {
  const [page, setPage] = useState(1)
  const [filter, setFilter] = useState({ role: '', department: '', search: '' })
  const content = Array.from(Array(numberOfTotalItems).keys())
    .map((item, index) => ({
      name: `User ${item + 1}`,
      role: index % 8 === 0 ? 'ADMIN' : 'USER',
      department: index % 3 === 0 ? 'HR' : 'SALES',
    }))
    .filter(
      (item) =>
        item.name.includes(filter.search) &&
        (filter.role === '' || item.role === filter.role) &&
        (filter.department === '' || item.department === filter.department)
    )
  const Filter = ({ variant, className }) => (
    <SectionHeaderGroup className={className}>
      <Select id="role" name="role" variant={variant}>
        <option className="bg-gray-600" value="">
          All roles
        </option>
        <option className="bg-gray-600" value="ADMIN">
          Admin
        </option>
        <option className="bg-gray-600" value="USER">
          User
        </option>
      </Select>
      <Select id="department" name="department" variant={variant}>
        <option className="bg-gray-600" value="">
          All departments
        </option>
        <option className="bg-gray-600" value="HR">
          Human Resources
        </option>
        <option className="bg-gray-600" value="IT">
          Engineering
        </option>
        <option className="bg-gray-600" value="SALES">
          Sales
        </option>
      </Select>
    </SectionHeaderGroup>
  )
  return (
    <Section>
      <SectionHeader className="mb-2">
        <SectionHeaderRow>
          <SectionTitle>List of users</SectionTitle>
          <SectionAction label="Add" icon={IconAdd} />
        </SectionHeaderRow>
        <SectionFilter
          initialValues={filter}
          onFilter={(values) => setFilter(values)}
        >
          <SectionHeaderRow layout={SectionHeaderRowLayout.full}>
            <SectionHeaderGroup
              spacing={SectionHeaderGroupSpacing.md}
              className="flex-col md:flex-row gap-y-2"
            >
              <SectionSearch className="w-full md:w-auto grow" />
              <Filter
                variant={InputVariant.transparent}
                className="hidden md:flex"
              />
              <Filter
                variant={InputVariant.soft}
                className="grid md:hidden grid-cols-2 w-full"
              />
            </SectionHeaderGroup>
          </SectionHeaderRow>
        </SectionFilter>
      </SectionHeader>
      <SectionContainer>
        <SectionContentList>
          {content.length > 0 &&
            content
              .slice(
                (page - 1) * numberOfItemsPerPage,
                (page - 1) * numberOfItemsPerPage + numberOfItemsPerPage
              )
              .map((item) => (
                <SectionListItemButton
                  key={item.name}
                  onClick={() => action('clicked')}
                >
                  {`${item.name} (${item.role} - ${item.department})`}
                </SectionListItemButton>
              ))}
          {content.length === 0 && (
            <SectionContentListEmpty>
              No users found in database.
            </SectionContentListEmpty>
          )}
        </SectionContentList>
        <SectionFooterWithPaginationInMemory
          page={page}
          size={numberOfItemsPerPage}
          total={content.length}
          onChangePage={setPage}
        />
      </SectionContainer>
    </Section>
  )
}

<Canvas>
  <Story
    name="Default"
    args={{
      numberOfTotalItems: 1000,
      numberOfItemsPerPage: 5,
    }}
  >
    {TemplateDefault.bind({})}
  </Story>
</Canvas>

### Props

<ArgsTable story="Default" />

# List with search

export const TemplateSearch = ({ numberOfTotalItems }) => {
  const [filter, setFilter] = useState({ search: '' })
  const content = Array.from(Array(numberOfTotalItems).keys())
    .map((item, index) => ({
      name: `User ${item + 1}`,
      role: index % 8 === 0 ? 'ADMIN' : 'USER',
      department: index % 3 === 0 ? 'HR' : 'SALES',
    }))
    .filter((item) => item.name.includes(filter.search))
  return (
    <Section>
      <SectionFilter
        initialValues={filter}
        onFilter={(values) => setFilter(values)}
      >
        <SectionHeader className="mb-2 md:mb-0">
          <SectionHeaderRow>
            <SectionTitle>List of users</SectionTitle>
            <SectionHeaderGroup>
              <SectionSearch className="hidden md:block" />
              <SectionAction label="Add" icon={IconAdd} />
            </SectionHeaderGroup>
          </SectionHeaderRow>
          <SectionHeaderRow
            layout={SectionHeaderRowLayout.full}
            className="block md:hidden"
          >
            <SectionSearch />
          </SectionHeaderRow>
        </SectionHeader>
      </SectionFilter>
      <SectionContainer>
        <SectionContentList>
          {content.length > 0 &&
            content.map((item) => (
              <SectionListItemButton
                key={item.name}
                onClick={() => action('clicked')}
              >
                {`${item.name} (${item.role} - ${item.department})`}
              </SectionListItemButton>
            ))}
          {content.length === 0 && (
            <SectionContentListEmpty>
              No users found in database.
            </SectionContentListEmpty>
          )}
        </SectionContentList>
      </SectionContainer>
    </Section>
  )
}

<Canvas>
  <Story
    name="Search"
    args={{
      numberOfTotalItems: 10,
    }}
  >
    {TemplateSearch.bind({})}
  </Story>
</Canvas>

# List with content title

export const TemplateWithContentTitle = () => {
  const content = Array.from(Array(3).keys()).map((item, index) => ({
    name: `User ${item + 1}`,
    role: index % 8 === 0 ? 'ADMIN' : 'USER',
    department: index % 3 === 0 ? 'HR' : 'SALES',
  }))
  const list = (
    <SectionContentList>
      {content.length > 0 &&
        content.map((item) => (
          <SectionListItemButton
            key={item.name}
            onClick={() => action('clicked')}
          >
            {`${item.name} (${item.role} - ${item.department})`}
          </SectionListItemButton>
        ))}
    </SectionContentList>
  )
  return (
    <Section>
      <SectionHeader>
        <SectionTitle>List of users</SectionTitle>
      </SectionHeader>
      <SectionContainer>
        {list}
        <SectionContentTitle>Section Content Title</SectionContentTitle>
        {list}
        <SectionFooter>
          <Actions>
            <Button>Submit</Button>
            <Button variant={ButtonVariant.ghost} className="lg:order-first">
              Cancel
            </Button>
          </Actions>
        </SectionFooter>
      </SectionContainer>
    </Section>
  )
}

<Canvas>
  <Story
    name="ContentTitle"
    args={{
      numberOfTotalItems: 1000,
      numberOfItemsPerPage: 5,
    }}
  >
    {TemplateWithContentTitle.bind({})}
  </Story>
</Canvas>

# Simple List

export const TemplateSimpleList = () => {
  const content = Array.from(Array(5).keys()).map((item, index) => ({
    name: `User ${item + 1}`,
    role: index % 8 === 0 ? 'ADMIN' : 'USER',
    department: index % 3 === 0 ? 'HR' : 'SALES',
  }))
  return (
    <Section>
      <SectionHeader>
        <SectionTitle>List of users</SectionTitle>
      </SectionHeader>
      <SectionContainer>
        <SectionContentList>
          {content.length > 0 &&
            content.map((item) => (
              <SectionListItemButton
                key={item.name}
                onClick={() => action('clicked')}
              >
                {`${item.name} (${item.role} - ${item.department})`}
              </SectionListItemButton>
            ))}
          {content.length === 0 && (
            <SectionContentListEmpty>
              No users found in database.
            </SectionContentListEmpty>
          )}
        </SectionContentList>
      </SectionContainer>
    </Section>
  )
}

<Canvas>
  <Story name="SimpleList">{TemplateSimpleList.bind({})}</Story>
</Canvas>

# List with filter dialog

This exmpale uses a dialog for the filter on smaller screen sizes, whereas the larger layout shows the filter in the section header.
This example is based on two libraries that you need to install in your project as well:

```
npm i @reach/dialog @aboutbits/react-toolbox
```

export const TemplateListWithFilterDialog = ({
  numberOfTotalItems,
  numberOfItemsPerPage,
}) => {
  const [page, setPage] = useState(1)
  const [filter, setFilter] = useState({ role: '', department: '', search: '' })
  const [dialogShow, setDialogShow] = useState(false)
  const isDialogEnabled = useMatchMediaQuery('(max-width: 768px)')
  const content = Array.from(Array(numberOfTotalItems).keys())
    .map((item, index) => ({
      name: `User ${item + 1}`,
      role: index % 8 === 0 ? 'ADMIN' : 'USER',
      department: index % 3 === 0 ? 'HR' : 'SALES',
    }))
    .filter(
      (item) =>
        item.name.includes(filter.search) &&
        (filter.role === '' || item.role === filter.role) &&
        (filter.department === '' || item.department === filter.department)
    )
  const Filters = () => (
    <>
      <Select id="role" name="role" variant={InputVariant.transparent}>
        <option className="bg-gray-600" value="">
          All roles
        </option>
        <option className="bg-gray-600" value="ADMIN">
          Admin
        </option>
        <option className="bg-gray-600" value="USER">
          User
        </option>
      </Select>
      <Select
        id="department"
        name="department"
        variant={InputVariant.transparent}
      >
        <option className="bg-gray-600" value="">
          All departments
        </option>
        <option className="bg-gray-600" value="HR">
          Human Resources
        </option>
        <option className="bg-gray-600" value="IT">
          Engineering
        </option>
        <option className="bg-gray-600" value="SALES">
          Sales
        </option>
      </Select>
      <SectionSearch className="col-span-full" />
    </>
  )
  return (
    <>
      {isDialogEnabled && dialogShow && (
        <Dialog
          onDismiss={() => setDialogShow(false)}
          aria-label="Filter"
          className="mx-auto bg-white overflow-hidden"
        >
          <DialogHeader onDismiss={() => setDialogShow(false)} title="Filter" />
          <SectionFilter
            initialValues={filter}
            enableReinitialize
            autoSubmit={false}
            onFilter={(values) => {
              setFilter(values)
              setDialogShow(false)
            }}
            className="p-4 grid grid-cols-1 gap-y-2 bg-white border-b border-neutral-500"
          >
            <Filters />
            <SubmitButton className="col-span-full mt-2">
              Apply filter
            </SubmitButton>
          </SectionFilter>
        </Dialog>
      )}
      <Section>
        <SectionHeader>
          <SectionHeaderRow>
            <SectionTitle>List of users</SectionTitle>
            {isDialogEnabled ? (
              <SectionHeaderGroup>
                <div className="relative flex items-center">
                  <SectionAction
                    icon={IconFilterList}
                    label="Filter"
                    onClick={() => setDialogShow(true)}
                  />
                  {filter.department !== '' ||
                    filter.role !== '' ||
                    (filter.search !== '' && (
                      <div className="absolute left-0 p-1 bg-primary-500 rounded-full" />
                    ))}
                </div>
              </SectionHeaderGroup>
            ) : (
              <SectionFilter
                initialValues={filter}
                enableReinitialize
                onFilter={(values) => setFilter(values)}
                className="flex"
              >
                <SectionHeaderGroup>
                  <Filters />
                </SectionHeaderGroup>
              </SectionFilter>
            )}
          </SectionHeaderRow>
        </SectionHeader>
        <SectionContainer>
          <SectionContentList>
            {content.length > 0 &&
              content
                .slice(
                  (page - 1) * numberOfItemsPerPage,
                  (page - 1) * numberOfItemsPerPage + numberOfItemsPerPage
                )
                .map((item) => (
                  <SectionListItemButton
                    key={item.name}
                    onClick={action('clicked')}
                  >
                    {`${item.name} (${item.role} - ${item.department})`}
                  </SectionListItemButton>
                ))}
            {content.length === 0 && (
              <SectionContentListEmpty>
                No users found in database.
              </SectionContentListEmpty>
            )}
          </SectionContentList>
          <SectionFooterWithPaginationInMemory
            page={page}
            size={numberOfItemsPerPage}
            total={content.length}
            onChangePage={setPage}
          />
        </SectionContainer>
      </Section>
    </>
  )
}

<Canvas>
  <Story
    name="ListWithFilterDialog"
    args={{
      numberOfTotalItems: 1000,
      numberOfItemsPerPage: 5,
    }}
  >
    {TemplateListWithFilterDialog.bind({})}
  </Story>
</Canvas>
