import { Meta, Story, Canvas } from '@storybook/addon-docs'
import { useIntl } from 'react-intl'
import { Formik } from 'formik'
import * as Yup from 'yup'
import { actions } from '@storybook/addon-actions'
import { ContentArea } from '../components/content'
import { Form, Input, Select, TextArea } from '../components/form'
import {
  Section,
  SectionContainer,
  SectionContentTwoColumn,
  SectionHeader,
  SectionTitle,
  SectionFooter,
} from '../components/section'
import { Actions } from '../components/action'
import { SubmitButton } from '../components/button/SubmitButton'
import { i18n, locales } from './i18n'

<Meta title="Examples/Form" />

# Form

The following example shows how a potential form could look like.

`formik` is used to handle the form.

As schema validator `yup` is used.

```
npm install yup
```

export const Template = ({ title }) => {
  const intl = useIntl()
  const initialValues = {
    email: 'info@aboutbits.it',
    name: 'John Doe',
    language: 'EN',
    role: 'USER',
    bio: 'John is a software engineer from Bolzano, Italy.',
  }
  const schema = Yup.object().shape({
    email: Yup.string().email().required(),
    name: Yup.string().required(),
    language: Yup.string().required(),
    role: Yup.string().required(),
    bio: Yup.string(),
  })
  return (
    <ContentArea>
      <Formik
        initialValues={initialValues}
        validationSchema={schema}
        validateOnBlur={true}
        validateOnChange={true}
        onSubmit={async (values) => {
          await new Promise((resolve) => setTimeout(resolve, 500))
          actions(JSON.stringify(values))
        }}
      >
        <Form>
          <Section>
            <SectionHeader>
              <SectionTitle>{title}</SectionTitle>
            </SectionHeader>
            <SectionContainer>
              <SectionContentTwoColumn>
                <Input
                  id="name"
                  type="text"
                  autoCapitalize="none"
                  name="name"
                  placeholder={intl.formatMessage({
                    id: 'shared.field.name',
                  })}
                  label={intl.formatMessage({ id: 'shared.field.name' })}
                />
                <Input
                  id="email"
                  type="email"
                  autoCapitalize="none"
                  name="email"
                  placeholder={intl.formatMessage({
                    id: 'shared.field.email',
                  })}
                  label={intl.formatMessage({ id: 'shared.field.email' })}
                />
                <Select
                  id="language"
                  autoCapitalize="none"
                  name="language"
                  label={intl.formatMessage({ id: 'shared.field.language' })}
                >
                  {i18n.supportedLanguages.map((supportedLanguage, index) => (
                    <option
                      className="bg-gray-600"
                      key={index}
                      value={supportedLanguage}
                    >
                      {locales[supportedLanguage]}
                    </option>
                  ))}
                </Select>
                <Select
                  id="role"
                  autoCapitalize="none"
                  name="role"
                  label="Role"
                >
                  <option className="bg-gray-600" value="ADMIN">
                    Admin
                  </option>
                  <option className="bg-gray-600" value="USER">
                    User
                  </option>
                </Select>
                <TextArea
                  id="bio"
                  rows="3"
                  className="xl:col-span-2"
                  name="bio"
                  label="Bio"
                />
              </SectionContentTwoColumn>
              <SectionFooter>
                <Actions>
                  <SubmitButton>Save</SubmitButton>
                </Actions>
              </SectionFooter>
            </SectionContainer>
          </Section>
        </Form>
      </Formik>
    </ContentArea>
  )
}

<Canvas>
  <Story name="Default" args={{ title: 'User edit' }}>
    {Template.bind({})}
  </Story>
</Canvas>
