import { Meta, Story, Canvas } from '@storybook/addon-docs'
import { useIntl } from 'react-intl'
import { Formik, Form } from 'formik'
import * as Yup from 'yup'
import { action } from '@storybook/addon-actions'
import { ContentArea } from '../components/content'
import { Input, Select, TextArea, Option } from '../components/form'
import {
  Section,
  SectionContainer,
  SectionHeader,
  SectionFooterWithActions,
  SectionContent,
  Layout,
} from '../components/section'
import { SubmitButton } from '../components/button'
import { i18n, locales } from './i18n'

<Meta title="Examples/Form" />

# Form

The following example shows how a potential form could look like.

`formik` is used to handle the form.

As schema validator `yup` is used.

```
npm install yup
```

export const Template = ({ title }) => {
  const intl = useIntl()
  const initialValues = {
    email: 'info@aboutbits.it',
    name: 'John Doe',
    language: 'EN',
    role: 'USER',
    bio: 'John is a software engineer from Bolzano, Italy.',
  }
  const schema = Yup.object().shape({
    email: Yup.string().email().required(),
    name: Yup.string().required(),
    language: Yup.string().required(),
    role: Yup.string().required(),
    bio: Yup.string(),
  })
  return (
    <ContentArea>
      <Formik
        initialValues={initialValues}
        validationSchema={schema}
        validateOnBlur={true}
        validateOnChange={true}
        onSubmit={async (values) => {
          await new Promise((resolve) => setTimeout(resolve, 500))
          action('onSubmit')(values)
        }}
      >
        <Form>
          <Section>
            <SectionHeader title={title} />
            <SectionContainer>
              <SectionContent layout={Layout.twoColumnGrid}>
                <Input
                  id="name"
                  type="text"
                  autoCapitalize="none"
                  name="name"
                  placeholder={intl.formatMessage({
                    id: 'shared.field.name',
                  })}
                  label={intl.formatMessage({ id: 'shared.field.name' })}
                />
                <Input
                  id="email"
                  type="email"
                  autoCapitalize="none"
                  name="email"
                  placeholder={intl.formatMessage({
                    id: 'shared.field.email',
                  })}
                  label={intl.formatMessage({ id: 'shared.field.email' })}
                />
                <Select
                  id="language"
                  autoCapitalize="none"
                  name="language"
                  label={intl.formatMessage({ id: 'shared.field.language' })}
                >
                  {i18n.supportedLanguages.map((supportedLanguage, index) => (
                    <Option key={index} value={supportedLanguage}>
                      {locales[supportedLanguage]}
                    </Option>
                  ))}
                </Select>
                <Select
                  id="role"
                  autoCapitalize="none"
                  name="role"
                  label="Role"
                >
                  <Option value="ADMIN">Admin</Option>
                  <Option value="USER">User</Option>
                </Select>
                <TextArea
                  id="bio"
                  rows="3"
                  className="xl:col-span-2"
                  name="bio"
                  label="Bio"
                />
              </SectionContent>
              <SectionFooterWithActions>
                <SubmitButton>Save</SubmitButton>
              </SectionFooterWithActions>
            </SectionContainer>
          </Section>
        </Form>
      </Formik>
    </ContentArea>
  )
}

<Canvas>
  <Story name="Default" args={{ title: 'User edit' }}>
    {Template.bind({})}
  </Story>
</Canvas>
